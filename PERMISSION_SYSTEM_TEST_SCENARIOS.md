# 管理员权限系统测试场景

本文档提供了完整的测试场景，用于验证管理员权限分配系统的功能。

## 测试环境准备

### 前置条件
1. 系统已部署并运行
2. 数据库已创建且包含必要的表
3. 至少有一个超级管理员账号可用于登录

### 测试数据准备

建议创建以下测试账号：

```sql
-- 如果还没有超级管理员，先创建一个
-- INSERT INTO SuperAdmins (Username, PasswordHash, FullName, IsActive, CreatedDate)
-- VALUES ('superadmin', '密码哈希值', '超级管理员', 1, GETDATE());

-- 创建不同权限的测试管理员
INSERT INTO Admins (Username, PasswordHash, FullName, Character, IsActive, CreatedDate)
VALUES 
    ('admin_user', '密码哈希值', '用户管理员', 'user_management', 1, GETDATE()),
    ('admin_recycler', '密码哈希值', '回收员管理员', 'recycler_management', 1, GETDATE()),
    ('admin_feedback', '密码哈希值', '反馈管理员', 'feedback_management', 1, GETDATE()),
    ('admin_homepage', '密码哈希值', '首页管理员', 'homepage_management', 1, GETDATE()),
    ('admin_full', '密码哈希值', '全权管理员', 'full_access', 1, GETDATE()),
    ('admin_none', '密码哈希值', '无权限管理员', NULL, 1, GETDATE());
```

## 测试场景

### 场景1: 超级管理员权限分配

**目的**: 验证超级管理员可以为普通管理员分配和修改权限

**测试步骤**:
1. 使用超级管理员账号登录
2. 导航到"管理员管理"页面
3. 点击"添加管理员"按钮
4. 填写表单：
   - 用户名: test_admin_1
   - 密码: Test@123
   - 姓名: 测试管理员1
   - 权限: 选择"用户管理"
   - 激活状态: 勾选
5. 点击"保存"

**预期结果**:
- ✅ 成功创建管理员
- ✅ 管理员列表显示新管理员
- ✅ 权限列显示"用户管理"标签
- ✅ 显示成功提示消息

**测试步骤 - 修改权限**:
1. 在管理员列表找到刚创建的管理员
2. 点击"编辑"按钮
3. 修改权限为"回收员管理"
4. 点击"保存"

**预期结果**:
- ✅ 权限更新成功
- ✅ 列表中权限显示更新为"回收员管理"
- ✅ 显示成功提示消息

---

### 场景2: 用户管理权限验证

**目的**: 验证具有"用户管理"权限的管理员只能访问用户管理功能

**测试步骤**:
1. 使用 admin_user (用户管理权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏显示"用户管理"链接
- ✅ 导航栏不显示"回收员管理"
- ✅ 导航栏不显示"反馈管理"
- ✅ 导航栏不显示"首页页面管理"

**测试步骤 - 访问授权功能**:
1. 点击"用户管理"链接

**预期结果**:
- ✅ 成功进入用户管理页面
- ✅ 可以查看用户列表
- ✅ 可以执行用户管理操作

**测试步骤 - 访问未授权功能**:
1. 在浏览器地址栏直接输入回收员管理URL
   - 例如: `/Staff/RecyclerManagement`
2. 按Enter访问

**预期结果**:
- ✅ 无法访问页面
- ✅ 显示"权限不足"页面
- ✅ 页面提示需要"回收员管理"权限
- ✅ 提供返回工作台的链接

---

### 场景3: 回收员管理权限验证

**目的**: 验证具有"回收员管理"权限的管理员只能访问回收员管理功能

**测试步骤**:
1. 使用 admin_recycler (回收员管理权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏不显示"用户管理"
- ✅ 导航栏显示"回收员管理"链接
- ✅ 导航栏不显示"反馈管理"
- ✅ 导航栏不显示"首页页面管理"

**测试步骤 - 功能访问验证**:
1. 点击"回收员管理"
2. 尝试直接访问 `/Staff/UserManagement`

**预期结果**:
- ✅ 可以访问回收员管理页面
- ✅ 访问用户管理时显示权限不足页面

---

### 场景4: 反馈管理权限验证

**目的**: 验证具有"反馈管理"权限的管理员只能访问反馈管理功能

**测试步骤**:
1. 使用 admin_feedback (反馈管理权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏不显示"用户管理"
- ✅ 导航栏不显示"回收员管理"
- ✅ 导航栏显示"反馈管理"链接
- ✅ 导航栏不显示"首页页面管理"

**测试步骤 - 功能访问验证**:
1. 点击"反馈管理"
2. 验证可以正常使用反馈管理功能

**预期结果**:
- ✅ 可以访问反馈管理页面
- ✅ 可以查看反馈列表
- ✅ 可以处理反馈

---

### 场景5: 首页页面管理权限验证

**目的**: 验证具有"首页页面管理"权限的管理员只能访问首页页面管理功能

**测试步骤**:
1. 使用 admin_homepage (首页管理权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏不显示"用户管理"
- ✅ 导航栏不显示"回收员管理"
- ✅ 导航栏不显示"反馈管理"
- ✅ 导航栏显示"首页页面管理"链接

**测试步骤 - 功能访问验证**:
1. 点击"首页页面管理"
2. 验证可以管理轮播图等首页内容

**预期结果**:
- ✅ 可以访问首页页面管理
- ✅ 可以管理首页内容

---

### 场景6: 全部权限验证

**目的**: 验证具有"全部权限"的管理员可以访问所有管理功能

**测试步骤**:
1. 使用 admin_full (全部权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏显示"用户管理"链接
- ✅ 导航栏显示"回收员管理"链接
- ✅ 导航栏显示"反馈管理"链接
- ✅ 导航栏显示"首页页面管理"链接

**测试步骤 - 功能访问验证**:
1. 依次点击每个导航链接
2. 验证每个页面都可以正常访问

**预期结果**:
- ✅ 所有管理页面都可以访问
- ✅ 所有功能都可以正常使用
- ✅ 没有权限限制

---

### 场景7: 无权限管理员验证

**目的**: 验证未设置权限的管理员无法访问任何管理功能

**测试步骤**:
1. 使用 admin_none (无权限) 账号登录
2. 查看导航栏

**预期结果**:
- ✅ 导航栏不显示任何管理功能链接
- ✅ 只显示工作台中心按钮

**测试步骤 - 尝试访问功能**:
1. 直接在地址栏输入任意管理功能URL
   - 例如: `/Staff/UserManagement`

**预期结果**:
- ✅ 显示权限不足页面
- ✅ 所有管理功能都无法访问

---

### 场景8: 权限变更实时生效

**目的**: 验证权限修改后立即生效

**测试步骤**:
1. 使用 admin_user 账号登录并保持登录状态
2. 在另一个浏览器窗口，使用超级管理员登录
3. 修改 admin_user 的权限从"用户管理"改为"回收员管理"
4. 保存修改
5. 回到 admin_user 的浏览器窗口
6. 刷新页面

**预期结果**:
- ✅ 导航栏更新，不再显示"用户管理"
- ✅ 导航栏显示"回收员管理"
- ✅ 尝试访问用户管理会被拒绝
- ✅ 可以正常访问回收员管理

---

### 场景9: 超级管理员特权验证

**目的**: 验证超级管理员不受权限限制

**测试步骤**:
1. 使用超级管理员账号登录
2. 访问所有管理功能

**预期结果**:
- ✅ 可以访问用户管理
- ✅ 可以访问回收员管理
- ✅ 可以访问反馈管理
- ✅ 可以访问首页页面管理
- ✅ 可以访问管理员管理
- ✅ 所有功能均无权限限制

---

### 场景10: 权限边界测试

**目的**: 验证权限检查的准确性

**测试步骤**:
1. 使用具有"用户管理"权限的账号登录
2. 尝试通过各种方式访问未授权功能：
   - 直接URL访问
   - 修改浏览器地址栏
   - 使用浏览器后退按钮
   - 书签访问

**预期结果**:
- ✅ 所有尝试均被拦截
- ✅ 均显示权限不足页面
- ✅ 无法绕过权限检查

---

### 场景11: 并发权限修改

**目的**: 验证系统处理并发权限修改的能力

**测试步骤**:
1. 使用两个超级管理员账号同时登录
2. 同时编辑同一个管理员的权限
3. 分别保存不同的权限设置

**预期结果**:
- ✅ 两次修改都能成功保存
- ✅ 最后一次修改生效
- ✅ 没有数据不一致的情况

---

### 场景12: 禁用管理员测试

**目的**: 验证禁用的管理员无法登录

**测试步骤**:
1. 使用超级管理员登录
2. 编辑某个管理员，取消"激活状态"勾选
3. 保存修改
4. 尝试使用被禁用的管理员账号登录

**预期结果**:
- ✅ 无法登录或显示账号已禁用提示
- ✅ 已登录的会话应该失效（如果有实现）

---

## 性能测试

### 场景13: 导航栏渲染性能

**测试步骤**:
1. 使用不同权限的账号登录
2. 多次刷新页面
3. 观察导航栏加载速度

**预期结果**:
- ✅ 导航栏快速渲染，无明显延迟
- ✅ 权限检查不影响页面加载速度

---

## 安全测试

### 场景14: SQL注入测试

**测试步骤**:
1. 在权限字段尝试输入SQL注入代码
2. 尝试创建管理员

**预期结果**:
- ✅ SQL注入代码被正确转义或拒绝
- ✅ 系统不受影响

### 场景15: XSS测试

**测试步骤**:
1. 在管理员名称或权限相关字段输入JavaScript代码
2. 保存并查看显示

**预期结果**:
- ✅ JavaScript代码不执行
- ✅ 内容被正确转义显示

---

## 测试检查清单

在完成所有测试后，请确认以下项目：

- [ ] 所有5种权限类型都已测试
- [ ] 权限授予和撤销都正常工作
- [ ] 导航栏正确反映权限状态
- [ ] 后端权限验证有效
- [ ] 超级管理员不受权限限制
- [ ] 未授权访问被正确拦截
- [ ] 权限不足页面正确显示
- [ ] 数据库正确存储权限信息
- [ ] 无明显性能问题
- [ ] 无安全漏洞

---

## 问题记录模板

在测试过程中发现问题，请使用以下模板记录：

```
**问题标题**: [简短描述问题]

**测试场景**: [场景编号和名称]

**重现步骤**:
1. 
2. 
3. 

**预期结果**: 

**实际结果**: 

**严重程度**: [低/中/高/严重]

**截图**: [如果有]

**环境信息**:
- 浏览器: 
- 操作系统: 
- 数据库: 
```

---

## 测试完成标准

测试被认为完成当：

1. 所有测试场景都已执行
2. 所有预期结果都达成
3. 发现的问题都已记录
4. 关键问题都已修复
5. 回归测试通过

---

**文档版本**: 1.0  
**创建日期**: 2025-11-20  
**测试负责人**: [待填写]
