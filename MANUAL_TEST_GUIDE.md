# 用户反馈功能手动测试指南

## 测试目的
验证基于 UserFeedback 实体类的用户反馈提交功能是否完全实现并正常工作。

## 前置条件

### 1. 数据库准备
```sql
-- 连接到 SQL Server
USE RecyclingSystemDB;
GO

-- 运行表创建脚本（如果表不存在）
-- 文件: Database/CreateUserFeedbackTable.sql

-- 验证表已创建
SELECT * FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME = 'UserFeedback';
-- 应该返回一行记录
```

### 2. 用户账号准备
- 确保有至少一个测试用户账号
- 记录用户名和密码
- 如需创建测试用户，访问注册页面

### 3. 应用启动
- 在 Visual Studio 中打开解决方案
- 按 F5 或点击"开始调试"
- 等待应用启动并打开浏览器

## 测试步骤

### 测试用例 1：未登录访问限制

**目的**：验证未登录用户无法访问反馈功能

**步骤**：
1. 清除浏览器 Cookie 或使用无痕模式
2. 访问首页
3. 点击"问题反馈"链接或直接访问 `/Home/Feedback`

**预期结果**：
- ✅ 自动重定向到登录选择页面 (`/Home/LoginSelect`)
- ✅ 不显示反馈表单

**实际结果**：
- [ ] 通过
- [ ] 失败（原因：______________）

---

### 测试用例 2：登录用户可以访问反馈页面

**目的**：验证已登录用户可以访问反馈表单

**步骤**：
1. 登录系统（使用测试用户账号）
2. 点击导航栏的"问题反馈"链接
3. 或直接访问 `/Home/Feedback`

**预期结果**：
- ✅ 成功进入反馈页面
- ✅ 看到标题"问题反馈"
- ✅ 看到副标题"您的反馈对我们非常重要，帮助我们提供更好的服务"
- ✅ 显示完整的反馈表单

**实际结果**：
- [ ] 通过
- [ ] 失败（原因：______________）

---

### 测试用例 3：表单字段验证

**目的**：验证客户端表单验证正常工作

#### 3.1 未选择反馈类型
**步骤**：
1. 填写主题："测试主题"
2. 填写描述："这是测试描述，验证表单验证是否工作"
3. 不选择任何反馈类型
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："请选择反馈类型"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 3.2 主题为空
**步骤**：
1. 选择反馈类型："问题反馈"
2. 主题留空
3. 填写描述："这是测试描述"
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："请输入反馈主题"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 3.3 主题超长
**步骤**：
1. 选择反馈类型："问题反馈"
2. 输入超过100字的主题
3. 填写描述："这是测试描述，验证主题长度限制"
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："反馈主题不能超过100字"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 3.4 描述为空
**步骤**：
1. 选择反馈类型："问题反馈"
2. 填写主题："测试主题"
3. 描述留空
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："请输入详细描述"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 3.5 描述过短
**步骤**：
1. 选择反馈类型："问题反馈"
2. 填写主题："测试主题"
3. 填写描述："短描述"（少于10字）
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："详细描述至少需要10个字符"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 3.6 描述超长
**步骤**：
1. 选择反馈类型："问题反馈"
2. 填写主题："测试主题"
3. 填写超过1000字的描述
4. 点击"提交反馈"

**预期结果**：
- ✅ 显示错误提示："详细描述不能超过1000字"
- ✅ 表单不提交

**实际结果**：
- [ ] 通过
- [ ] 失败

---

### 测试用例 4：成功提交反馈（完整测试）

**目的**：验证完整的反馈提交流程

**步骤**：
1. 确保已登录
2. 访问反馈页面 `/Home/Feedback`
3. 选择反馈类型："问题反馈"
4. 输入主题："测试反馈提交功能"
5. 输入描述："这是一个测试描述，用于验证用户反馈提交功能是否正常工作。测试时间：" + 当前时间
6. 输入邮箱："test@example.com"（可选）
7. 点击"提交反馈"按钮

**预期结果**：
- ✅ 提交按钮变为"提交中..."并禁用
- ✅ 显示成功提示："反馈提交成功！感谢您的反馈"
- ✅ 表单字段被清空
- ✅ 字符计数器重置为 0
- ✅ 约2秒后自动跳转到首页

**实际结果**：
- [ ] 通过
- [ ] 失败（原因：______________）

---

### 测试用例 5：数据库验证

**目的**：验证数据成功写入数据库

**步骤**：
1. 完成测试用例 4
2. 打开 SQL Server Management Studio
3. 运行以下查询：

```sql
USE RecyclingSystemDB;
GO

-- 查看最新的反馈记录
SELECT TOP 1 
    FeedbackID,
    UserID,
    FeedbackType,
    Subject,
    Description,
    ContactEmail,
    Status,
    CreatedDate
FROM UserFeedback 
ORDER BY CreatedDate DESC;
```

**预期结果**：
- ✅ 返回一条记录
- ✅ FeedbackType = '问题反馈'
- ✅ Subject = '测试反馈提交功能'
- ✅ Description 包含测试描述文本
- ✅ ContactEmail = 'test@example.com'
- ✅ Status = '反馈中'
- ✅ CreatedDate 是当前时间
- ✅ UserID 是登录用户的 ID

**实际结果**：
- [ ] 通过
- [ ] 失败（原因：______________）

---

### 测试用例 6：测试所有反馈类型

**目的**：验证所有反馈类型都可以正常提交

#### 6.1 功能建议
**步骤**：
1. 选择反馈类型："功能建议"
2. 填写主题："建议添加新功能"
3. 填写描述："建议在系统中添加统计报表功能，方便查看数据分析"
4. 点击提交

**预期结果**：✅ 提交成功

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 6.2 投诉举报
**步骤**：
1. 选择反馈类型："投诉举报"
2. 填写主题："投诉回收员服务态度"
3. 填写描述："某某回收员服务态度不好，需要改进服务质量"
4. 点击提交

**预期结果**：✅ 提交成功

**实际结果**：
- [ ] 通过
- [ ] 失败

#### 6.3 其他
**步骤**：
1. 选择反馈类型："其他"
2. 填写主题："其他类型反馈"
3. 填写描述："这是一个其他类型的反馈，用于测试该选项是否正常工作"
4. 点击提交

**预期结果**：✅ 提交成功

**实际结果**：
- [ ] 通过
- [ ] 失败

---

### 测试用例 7：不填写可选字段

**目的**：验证可选字段（联系邮箱）可以为空

**步骤**：
1. 选择反馈类型："问题反馈"
2. 填写主题："测试可选字段"
3. 填写描述："这个测试不填写邮箱字段，验证可选字段功能"
4. 联系邮箱留空
5. 点击提交

**预期结果**：
- ✅ 提交成功
- ✅ 数据库中 ContactEmail 字段为 NULL

**实际结果**：
- [ ] 通过
- [ ] 失败

---

### 测试用例 8：字符计数器功能

**目的**：验证实时字符计数功能

**步骤**：
1. 在主题输入框中输入文字
2. 观察下方的字符计数器

**预期结果**：
- ✅ 字符数实时更新
- ✅ 显示格式："X / 100"
- ✅ 接近限制时（≥90字）计数器变红色

**步骤**：
3. 在描述输入框中输入文字
4. 观察下方的字符计数器

**预期结果**：
- ✅ 字符数实时更新
- ✅ 显示格式："X / 1000"
- ✅ 接近限制时（≥900字）计数器变红色

**实际结果**：
- [ ] 通过
- [ ] 失败

---

### 测试用例 9：UI/UX 测试

**目的**：验证用户界面和交互体验

**检查项**：
- [ ] 页面标题醒目且美观
- [ ] 反馈类型选项卡有悬停效果
- [ ] 选中的反馈类型有明显的视觉反馈
- [ ] 输入框获得焦点时有边框高亮
- [ ] 提交按钮有渐变色背景
- [ ] 提交按钮悬停时有动画效果
- [ ] 成功/失败提示消息显示清晰
- [ ] 提示消息自动消失（5秒）
- [ ] 页面底部有联系信息
- [ ] 整体设计协调美观

**实际结果**：
- [ ] 通过
- [ ] 失败（原因：______________）

---

### 测试用例 10：浏览器兼容性

**目的**：验证在不同浏览器中的兼容性

**测试浏览器**：
- [ ] Chrome（最新版本）
- [ ] Firefox（最新版本）
- [ ] Edge（最新版本）
- [ ] Safari（如果使用 Mac）

**每个浏览器测试**：
1. 访问反馈页面
2. 填写并提交一个反馈
3. 验证功能正常

**实际结果**：
- Chrome: [ ] 通过 / [ ] 失败
- Firefox: [ ] 通过 / [ ] 失败
- Edge: [ ] 通过 / [ ] 失败
- Safari: [ ] 通过 / [ ] 失败

---

## 测试结果汇总

### 关键功能测试
| 测试用例 | 状态 | 备注 |
|---------|------|------|
| 1. 未登录访问限制 | [ ] Pass / [ ] Fail | |
| 2. 登录访问 | [ ] Pass / [ ] Fail | |
| 3. 表单验证 | [ ] Pass / [ ] Fail | |
| 4. 成功提交 | [ ] Pass / [ ] Fail | |
| 5. 数据库验证 | [ ] Pass / [ ] Fail | |
| 6. 所有反馈类型 | [ ] Pass / [ ] Fail | |
| 7. 可选字段 | [ ] Pass / [ ] Fail | |
| 8. 字符计数器 | [ ] Pass / [ ] Fail | |
| 9. UI/UX | [ ] Pass / [ ] Fail | |
| 10. 浏览器兼容性 | [ ] Pass / [ ] Fail | |

### 总体评估
- **通过的测试用例数**: _____ / 10
- **是否可以上线**: [ ] 是 / [ ] 否
- **需要修复的问题**: _______________
- **测试日期**: _______________
- **测试人员**: _______________

## 性能测试（可选）

### 测试场景：连续提交多个反馈

**步骤**：
1. 连续提交 10 个反馈
2. 记录每次提交的响应时间

**预期结果**：
- 每次提交响应时间 < 2 秒
- 所有提交都成功

**实际结果**：
- 平均响应时间: _____ 秒
- 成功率: _____ %

## 安全测试（可选）

### SQL 注入测试

**步骤**：
1. 在主题字段输入: `'; DROP TABLE UserFeedback; --`
2. 在描述字段输入正常内容
3. 提交

**预期结果**：
- ✅ 提交成功或被验证拒绝
- ✅ 数据库表未被删除
- ✅ 恶意代码被当作普通文本存储

### XSS 测试

**步骤**：
1. 在主题字段输入: `<script>alert('XSS')</script>`
2. 在描述字段输入正常内容
3. 提交
4. 在管理员端查看该反馈

**预期结果**：
- ✅ 不执行脚本
- ✅ 脚本代码被转义或移除

## 附录：测试数据模板

### 有效测试数据
```
反馈类型：问题反馈
主题：系统登录速度较慢
描述：我在使用系统时发现，每次登录都需要等待5-10秒才能进入系统主页，建议优化登录流程以提高响应速度。
邮箱：user@example.com
```

### 边界值测试数据

**主题（100字）**：
```
这是一个用于测试主题字段最大长度的测试数据内容这是一个用于测试主题字段最大长度的测试数据内容这是一个用于测试主题字段最大长度的测试数据内容这是一个用于测试主题字段最大长度的测试数
```

**描述（10字）**：
```
最短描述测试内容
```

**描述（1000字）**：
（准备一段1000字的测试文本）

## 测试完成后的清理

```sql
-- 删除测试数据（如果需要）
DELETE FROM UserFeedback 
WHERE Subject LIKE '%测试%' 
   OR Description LIKE '%测试%'
   OR ContactEmail = 'test@example.com';

-- 或者删除今天的所有测试数据
DELETE FROM UserFeedback 
WHERE CAST(CreatedDate AS DATE) = CAST(GETDATE() AS DATE)
  AND (Subject LIKE '%测试%' OR Description LIKE '%测试%');
```

## 结论

通过本测试指南，应该能够全面验证用户反馈提交功能是否完整实现并正常工作。

如果所有测试用例都通过，则可以确认：
✅ 用户反馈功能已成功实现
✅ 基于 UserFeedback 实体类的完整功能链已建立
✅ 功能可以投入生产使用

如果有测试用例失败，请参考《TROUBLESHOOTING_GUIDE.md》进行问题排查。
