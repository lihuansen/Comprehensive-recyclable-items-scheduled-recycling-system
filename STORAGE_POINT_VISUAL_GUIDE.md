# 暂存点管理功能 - 视觉指南

## 导航栏变化

### 修改前
```
订单管理 | 消息中心 | [回收员工作台] | 用户评价
```

### 修改后
```
订单管理 | 消息中心 | [回收员工作台] | 暂存点管理 | 用户评价
```

## 页面布局

### 暂存点管理页面结构

```
┌─────────────────────────────────────────────────────────┐
│                    暂存点管理                            │
│          管理您的回收物品库存 - 区域：XX街道              │
└─────────────────────────────────────────────────────────┘

┌───────────┐  ┌───────────┐  ┌───────────┐
│ 物品类别数 │  │  总重量   │  │  总价值   │
│    5      │  │ 123.45kg │  │ ¥456.78  │
└───────────┘  └───────────┘  └───────────┘

按类别统计

┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│  纸类       │  │  塑料       │  │  金属       │
│  45.60 kg  │  │  32.10 kg  │  │  25.30 kg  │
│  ¥89.50    │  │  ¥65.20    │  │  ¥125.80   │
└─────────────┘  └─────────────┘  └─────────────┘

[点击任意卡片查看详情]

详细信息表格（点击卡片后显示）

┌────────────────────────────────────────────────────────┐
│ [← 返回汇总]                                            │
│                                                         │
│ 纸类 - 详细信息                                         │
│                                                         │
│ ┌──────┬──────┬────────┬────────┬────────────┐       │
│ │订单号│类别  │重量(kg)│价值(元)│入库时间    │       │
│ ├──────┼──────┼────────┼────────┼────────────┤       │
│ │AP0001│纸类  │10.50   │¥21.00  │2024-01-15  │       │
│ │AP0002│纸类  │15.30   │¥30.60  │2024-01-14  │       │
│ │AP0003│纸类  │19.80   │¥37.90  │2024-01-13  │       │
│ └──────┴──────┴────────┴────────┴────────────┘       │
└────────────────────────────────────────────────────────┘
```

## 交互流程

```
1. 回收员登录
   ↓
2. 点击导航栏"暂存点管理"
   ↓
3. 进入暂存点管理页面
   ├─ 查看统计概览（类别数、总重量、总价值）
   ├─ 浏览各类别汇总卡片
   └─ 点击任意类别卡片
      ↓
   4. 查看该类别的详细库存记录
      ├─ 显示订单号、重量、价值、入库时间等
      └─ 点击"返回汇总"回到汇总视图
```

## 数据流向

```
用户下单 → 回收员接单 → 完成订单
                           ↓
                    写入Inventory表
                    (按RecyclerID存储)
                           ↓
                    暂存点管理页面
                    (按RecyclerID查询)
                           ↓
                    显示该回收员的库存
```

## 代码结构

```
recycling.Web.UI/
├── Controllers/
│   └── StaffController.cs
│       ├── StoragePointManagement()          [GET]  显示页面
│       ├── GetStoragePointSummary()          [POST] 获取汇总
│       └── GetStoragePointDetail()           [POST] 获取详情
│
├── Views/
│   ├── Shared/
│   │   └── _RecyclerLayout.cshtml            导航栏（已更新）
│   └── Staff/
│       └── StoragePointManagement.cshtml     暂存点管理页面
│
└── recycling.BLL/
    └── InventoryBLL.cs                       库存业务逻辑
        ├── GetInventorySummary()             获取汇总
        └── GetInventoryList()                获取明细
```

## 数据模型

### Inventory表结构
```
┌─────────────────┬──────────────┬─────────────────────┐
│ 字段            │ 类型         │ 说明                │
├─────────────────┼──────────────┼─────────────────────┤
│ InventoryID     │ int          │ 主键                │
│ OrderID         │ int          │ 订单ID              │
│ CategoryKey     │ varchar(50)  │ 类别键值            │
│ CategoryName    │ varchar(50)  │ 类别名称            │
│ Weight          │ decimal      │ 重量                │
│ RecyclerID      │ int          │ 回收员ID（关键）    │
│ CreatedDate     │ datetime2    │ 创建时间            │
│ Price           │ decimal      │ 价格                │
└─────────────────┴──────────────┴─────────────────────┘
```

### 数据查询逻辑
```
GetInventorySummary(RecyclerID)
    ↓
SELECT CategoryKey, CategoryName, 
       SUM(Weight) as TotalWeight, 
       SUM(Price) as TotalPrice
FROM Inventory
WHERE RecyclerID = @RecyclerID
GROUP BY CategoryKey, CategoryName

GetInventoryList(RecyclerID, PageIndex, PageSize)
    ↓
SELECT *
FROM Inventory
WHERE RecyclerID = @RecyclerID
ORDER BY CreatedDate DESC
```

## 安全措施

```
1. 身份验证
   └─ Session["LoginStaff"] 检查
   └─ Session["StaffRole"] == "recycler"

2. CSRF防护
   └─ [ValidateAntiForgeryToken] 属性
   └─ AJAX请求包含 __RequestVerificationToken

3. 数据隔离
   └─ 所有查询都过滤 RecyclerID
   └─ 回收员只能看到自己的数据

4. SQL注入防护
   └─ 使用Entity Framework参数化查询
```

## 响应式设计

### 桌面视图（>992px）
- 卡片3列布局
- 完整导航栏
- 宽松的间距

### 平板视图（768px-992px）
- 卡片2列布局
- 导航栏适配

### 移动视图（<768px）
- 卡片单列布局
- 折叠导航栏
- 紧凑的间距

## 性能优化

1. **数据加载**: 限制每次最多1000条记录
2. **按需加载**: 点击类别时才加载详细数据
3. **前端缓存**: 汇总数据缓存在内存中
4. **数据库索引**: RecyclerID应有索引

## 用户体验优化

1. **加载提示**: 显示"加载中..."状态
2. **空状态**: 无数据时显示友好提示
3. **错误提示**: Toast通知替代alert弹窗
4. **动画效果**: 卡片悬停和页面切换动画
5. **返回按钮**: 快速返回汇总视图
