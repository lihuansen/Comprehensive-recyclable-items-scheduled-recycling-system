# 入库单品类格式改进测试指南

## 测试目标
验证基地工作人员创建入库单时的品类输入格式改进是否正常工作，确保整个入库流程顺畅运行且没有错误。

## 前置条件

1. **数据库准备**：
   - 确保数据库中有活跃的可回收物品类别（RecyclableItems表）
   - 至少有一个已完成的运输单（TransportationOrders表，Status = '已完成'）
   - 运输单的ItemCategories字段包含有效的JSON格式品类数据

2. **用户登录**：
   - 使用基地工作人员（SortingCenterWorker）账号登录系统

## 测试场景

### 场景1：正常创建入库单流程

**测试步骤**：
1. 登录基地工作人员账号
2. 进入"仓库管理"页面
3. 在左侧"创建入库单"区域查看已完成的运输单列表
4. 点击选择一个运输单

**预期结果**：
- ✅ 表单自动填充运输单信息（运输单号、回收员、运输人员、取货时间、预估重量）
- ✅ "物品类别明细"区域显示一个表格，包含：
  - 表头：品类名称、重量（kg）、价值（元）
  - 每个品类占一行，显示图标、名称、重量、价值
  - 底部总计行显示总重量和总价值
- ✅ 表格为只读，无法编辑
- ✅ 显示锁图标提示"物品类别从运输单自动获取，不可修改"

**测试数据示例**：
```
品类名称  | 重量（kg） | 价值（元）
纸类      | 20.50     | ¥41.00
塑料      | 15.30     | ¥30.60
总计      | 35.80     | ¥71.60
```

### 场景2：创建入库单成功

**测试步骤**：
1. 完成场景1的步骤
2. 确认或修改"实际入库重量"
3. （可选）填写"入库备注"
4. 点击"创建入库单"按钮

**预期结果**：
- ✅ 显示成功提示："入库单创建成功！入库单号：WRYYYYMMDD0001"
- ✅ 表单自动关闭，返回运输单列表
- ✅ 右侧"入库单"列表自动刷新，显示新创建的入库单
- ✅ 新入库单状态为"待入库"
- ✅ 可以看到"入库"按钮

### 场景3：品类数据验证

**测试步骤**：
1. 尝试选择一个没有品类信息的运输单（如果有）
2. 或修改数据库中某个运输单的ItemCategories字段为空
3. 尝试选择该运输单并创建入库单

**预期结果**：
- ✅ 如果品类数据为空，表格显示"无类别信息"
- ✅ 点击"创建入库单"时显示错误："品类数据不能为空，请确保选择的运输单包含品类信息"

### 场景4：处理入库单入库

**测试步骤**：
1. 在右侧"入库单"列表中找到一个"待入库"状态的入库单
2. 点击"入库"按钮
3. 在确认对话框中点击"确认"

**预期结果**：
- ✅ 显示确认对话框："确认要将该入库单入库吗？入库后将写入库存记录。"
- ✅ 确认后显示成功提示："入库成功！库存已更新。"
- ✅ 入库单状态更新为"已入库"
- ✅ "入库"按钮消失，显示"-"
- ✅ 下方"当前库存信息"自动刷新，显示新增的库存数据

### 场景5：库存信息显示

**测试步骤**：
1. 完成场景4后，查看页面下方的"当前库存信息"区域
2. 点击某个品类卡片
3. 查看库存明细表格

**预期结果**：
- ✅ 库存汇总卡片显示各个品类的总重量和总价值
- ✅ 点击品类卡片后，下方显示该品类的详细库存明细
- ✅ 明细包括：入库单号、品类、重量、价值、回收员、入库时间
- ✅ 可以通过分页查看更多记录

### 场景6：错误处理测试

**子场景6.1：品类数据格式错误**
- 修改数据库中运输单的ItemCategories为无效JSON
- 尝试创建入库单并处理入库
- **预期**：显示错误"物品类别数据格式错误，无法解析JSON"

**子场景6.2：品类数据为空数组**
- 修改ItemCategories为 `[]`
- 尝试处理入库
- **预期**：显示错误"物品类别数据为空，无法入库"

**子场景6.3：网络错误模拟**
- 在控制台断开网络或模拟网络错误
- 尝试创建入库单
- **预期**：显示友好的错误信息，不应出现未处理的异常

## 回归测试

确保新改动没有破坏现有功能：

1. ✅ 已有的入库单可以正常显示
2. ✅ 已入库的记录状态正确
3. ✅ 库存统计数据准确
4. ✅ 其他基地工作人员功能（如运输单管理、暂存点管理）不受影响

## 性能测试

1. 测试大量品类数据的显示性能（如10+个品类）
2. 测试入库单列表的加载速度
3. 测试库存明细的分页性能

## 浏览器兼容性测试

在以下浏览器中测试：
- Chrome（推荐）
- Firefox
- Edge
- Safari（如有Mac环境）

## 已知限制

1. 品类数据完全依赖运输单的ItemCategories字段
2. 如果运输单没有品类数据，无法创建入库单
3. 品类数据不可修改（按需求设计）

## 测试结果记录

| 测试场景 | 测试日期 | 测试人员 | 结果 | 备注 |
|---------|---------|---------|------|------|
| 场景1   |         |         |      |      |
| 场景2   |         |         |      |      |
| 场景3   |         |         |      |      |
| 场景4   |         |         |      |      |
| 场景5   |         |         |      |      |
| 场景6.1 |         |         |      |      |
| 场景6.2 |         |         |      |      |
| 场景6.3 |         |         |      |      |

## 问题报告模板

如发现问题，请记录以下信息：
- **问题描述**：
- **重现步骤**：
- **预期结果**：
- **实际结果**：
- **浏览器/版本**：
- **截图**：
- **错误日志**：

## 注意事项

1. 测试前备份数据库
2. 在测试环境中进行完整测试后再部署到生产环境
3. 检查浏览器控制台的JavaScript错误
4. 检查服务器日志的异常信息
5. 确保数据库中RecyclableItems表有活跃的品类数据
