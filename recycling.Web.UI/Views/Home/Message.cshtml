@model int  // 订单ID

<div class="chat-container">
    <div id="messageList" class="message-list"></div>
    <div class="input-area">
        <textarea id="messageContent" placeholder="输入消息..."></textarea>
        <button onclick="sendMessage(@Model)">发送</button>
    </div>
</div>

<script src="~/Scripts/jquery-3.6.0.min.js"></script>
<script>
    // 页面加载时获取历史消息
    $(function () {
        loadMessages(@Model);
        // 定时刷新消息
        setInterval(() => loadMessages(@Model), 5000);
    });

    // 加载消息
    function loadMessages(orderId) {
        $.post("/Home/GetOrderMessages", { orderId: orderId }, function (res) {
            if (res.success) {
                let html = "";
                res.data.forEach(msg => {
                    const align = msg.SenderType === "user" ? "right" : "left";
                    html += `<div class="message ${align}">
                                <div class="sender">${msg.SenderType === "user" ? "我" : "回收员"}</div>
                                <div class="content">${msg.Content}</div>
                                <div class="time">${msg.SentTime}</div>
                            </div>`;
                });
                $("#messageList").html(html);
                // 滚动到底部
                $("#messageList").scrollTop($("#messageList")[0].scrollHeight);
            }
        });
    }

    // 发送消息
    function sendMessage(orderId) {
        const content = $("#messageContent").val().trim();
        if (!content) return;

        $.post("/Home/SendMessage", {
            OrderID: orderId,
            Content: content
        }, function (res) {
            if (res.success) {
                $("#messageContent").val("");
                loadMessages(orderId); // 刷新消息列表
            }
            alert(res.message);
        });
    }
</script>

<style>
    .chat-container {
        width: 800px;
        margin: 0 auto;
        border: 1px solid #ccc;
    }

    .message-list {
        height: 500px;
        overflow-y: auto;
        padding: 10px;
    }

    .message {
        margin: 5px 0;
        padding: 8px;
        max-width: 60%;
        border-radius: 8px;
    }

        .message.right {
            margin-left: auto;
            background: #e1f5fe;
        }

        .message.left {
            background: #f5f5f5;
        }

    .sender {
        font-size: 12px;
        color: #666;
    }

    .content {
        margin: 5px 0;
    }

    .time {
        font-size: 11px;
        color: #999;
        text-align: right;
    }

    .input-area {
        padding: 10px;
        display: flex;
        gap: 10px;
    }

    textarea {
        flex: 1;
        height: 60px;
    }

    button {
        padding: 0 20px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
    }
</style>