@model recycling.Model.LoginViewModel

@{
    var loginType = ViewBag.LoginType ?? "password";
}

<!-- 用户登录区域（与原代码完全一致） -->
<div id="userLoginArea">
    <!-- 登录方式链接 -->
    <div class="login-links">
        <a href="javascript:void(0);" id="passwordLogin" class="@(loginType == "password" ? "active" : "")" onclick="switchUserLogin('password')">密码登录</a>
        <a href="javascript:void(0);" id="phoneLogin" class="@(loginType == "phone" ? "active" : "")" onclick="switchUserLogin('phone')">手机号登录</a>
        <a href="javascript:void(0);" id="emailLogin" class="@(loginType == "email" ? "active" : "")" onclick="switchUserLogin('email')">邮箱登录</a>
        <a href="@Url.Action("Forgot", "User")" id="forgotPassword">忘记密码</a>
        <a href="@Url.Action("Register", "User")" id="goToRegister">前往注册</a>
    </div>

    <!-- 密码登录表单 - 使用强类型绑定 -->
    <div id="passwordForm" class="login-form @(loginType == "password" ? "active" : "")">
        @using (Html.BeginForm("Login", "User", FormMethod.Post, new { id = "passwordLoginForm" }))
        {
            @Html.AntiForgeryToken()

            <div class="form-group">
                @Html.LabelFor(m => m.Username)
                @Html.TextBoxFor(m => m.Username, new
                {
                    @class = "form-control",
                    placeholder = "请输入用户名",
                    required = "required"
                })
                @Html.ValidationMessageFor(m => m.Username, null, new { @class = "field-validation-error" })
            </div>

            <!-- 密码输入框添加小眼睛图标 -->
            <div class="form-group password-group">
                @Html.LabelFor(m => m.Password)
                <div class="password-input-container">
                    @Html.PasswordFor(m => m.Password, new
                    {
                        @class = "form-control password-input",
                        placeholder = "请输入密码",
                        required = "required",
                        id = "passwordInput"
                    })
                    <button type="button" class="toggle-password" id="togglePassword">
                        <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </button>
                </div>
                @Html.ValidationMessageFor(m => m.Password, null, new { @class = "field-validation-error" })
            </div>

            <div class="form-group">
                @Html.LabelFor(m => m.Captcha)
                <div class="captcha-container">
                    @Html.TextBoxFor(m => m.Captcha, new
                    {
                        @class = "form-control captcha-input",
                        placeholder = "请输入验证码",
                        maxlength = 4,
                        required = "required"
                    })
                    @Html.ValidationMessageFor(m => m.Captcha, null, new { @class = "field-validation-error" })

                    <div class="captcha-image" id="captchaImage" title="点击刷新验证码">
                    </div>
                </div>
                @Html.HiddenFor(m => m.GeneratedCaptcha, new { id = "generatedCaptcha" })
            </div>

            <div class="login-buttons">
                <button type="submit" class="btn btn-primary btn-login">登录</button>
                <button type="button" class="btn btn-danger btn-cancel" id="cancelBtn">取消</button>
            </div>
        }
    </div>

    <!-- 手机号登录表单 -->
    <div id="phoneForm" class="login-form @(loginType == "phone" ? "active" : "")">
        <form id="phoneLoginForm">
            <div class="form-group">
                <input type="text" class="form-control" id="phoneUsername" placeholder="请输入用户名" required>
            </div>

            <div class="form-group">
                <input type="text" class="form-control" id="phoneNumber" placeholder="请输入手机号" required>
            </div>

            <div class="form-group">
                <input type="text" class="form-control" id="phoneCode" placeholder="请输入手机验证码" required>
                <button type="button" class="send-code-btn" id="sendPhoneCode">发送验证码</button>
            </div>

            <div class="login-buttons">
                <button type="submit" class="btn btn-primary btn-login">登录</button>
                <button type="button" class="btn btn-danger btn-cancel" id="cancelBtn2">取消</button>
            </div>
        </form>
    </div>

    <!-- 邮箱登录表单 -->
    <div id="emailForm" class="login-form @(loginType == "email" ? "active" : "")">
        <form id="emailLoginForm">
            <div class="form-group">
                <input type="text" class="form-control" id="emailUsername" placeholder="请输入用户名" required>
            </div>

            <div class="form-group">
                <input type="email" class="form-control" id="emailAddress" placeholder="请输入邮箱" required>
            </div>

            <div class="form-group">
                <input type="text" class="form-control" id="emailCode" placeholder="请输入邮箱验证码" required>
                <button type="button" class="send-code-btn" id="sendEmailCode">发送验证码</button>
            </div>

            <div class="login-buttons">
                <button type="submit" class="btn btn-primary btn-login">登录</button>
                <button type="button" class="btn btn-danger btn-cancel" id="cancelBtn3">取消</button>
            </div>
        </form>
    </div>
</div>

<!-- 用户登录切换辅助脚本 -->
<script>
    // 切换用户登录方式（密码/手机/邮箱）
    function switchUserLogin(type) {
        // 隐藏所有表单
        document.getElementById('passwordForm').classList.remove('active');
        document.getElementById('phoneForm').classList.remove('active');
        document.getElementById('emailForm').classList.remove('active');

        // 移除所有链接的active类
        document.getElementById('passwordLogin').classList.remove('active');
        document.getElementById('phoneLogin').classList.remove('active');
        document.getElementById('emailLogin').classList.remove('active');

        // 显示选中的表单并添加active类
        document.getElementById(`${type}Form`).classList.add('active');
        document.getElementById(`${type}Login`).classList.add('active');

        // 切换到密码登录时刷新验证码
        if (type === 'password') {
            refreshCaptcha();
        }
    }
</script>
